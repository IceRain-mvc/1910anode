(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{270:function(e,s,a){"use strict";a.r(s);var t=a(28),n=Object(t.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h4",{attrs:{id:"版本回退"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#版本回退"}},[e._v("#")]),e._v(" 版本回退")]),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("现在，你已经学会了修改文件，然后把修改提交到Git版本库，现在，再练习一次，修改readme.txt文件如下：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Git is a distributed version control system.\nGit is free software distributed under the GPL.\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("然后尝试提交：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('$ git add readme.txt\n$ git commit -m "append GPL"\n[master 1094adb] append GPL\n 1 file changed, 1 insertion(+), 1 deletion(-)\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("p",[e._v("像这样，你不断对文件进行修改，然后不断提交修改到版本库里，就好比玩RPG游戏时，每通过一关就会自动把游戏状态存盘，如果某一关没过去，你还可以选择读取前一关的状态。有些时候，在打Boss之前，你会手动存盘，以便万一打Boss失败了，可以从最近的地方重新开始。Git也是一样，每当你觉得文件修改到一定程度的时候，就可以“保存一个快照”，这个快照在Git中被称为"),a("code",[e._v("commit")]),e._v("。一旦你把文件改乱了，或者误删了文件，还可以从最近的一个"),a("code",[e._v("commit")]),e._v("恢复，然后继续工作，而不是把几个月的工作成果全部丢失。")]),e._v(" "),a("p",[e._v("现在，我们回顾一下"),a("code",[e._v("readme.txt")]),e._v("文件一共有几个版本被提交到Git仓库里了：")]),e._v(" "),a("p",[e._v("版本1：wrote a readme file")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Git is a version control system.\nGit is free software.\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("版本2：add distributed")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Git is a distributed version control system.\nGit is free software.\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("版本3：append GPL")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Git is a distributed version control system.\nGit is free software distributed under the GPL.\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("当然了，在实际工作中，我们脑子里怎么可能记得一个几千行的文件每次都改了什么内容，不然要版本控制系统干什么。版本控制系统肯定有某个命令可以告诉我们历史记录，在Git中，我们用"),a("code",[e._v("git log")]),e._v("命令查看：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ git log\ncommit 1094adb7b9b3807259d8cb349e7df1d4d6477073 (HEAD -> master)\nAuthor: Michael Liao <askxuefeng@gmail.com>\nDate:   Fri May 18 21:06:15 2018 +0800\n\n    append GPL\n\ncommit e475afc93c209a690c39c13a46716e8fa000c366\nAuthor: Michael Liao <askxuefeng@gmail.com>\nDate:   Fri May 18 21:03:36 2018 +0800\n\n    add distributed\n\ncommit eaadf4e385e865d25c48e7ca9c8395c3f7dfaef0\nAuthor: Michael Liao <askxuefeng@gmail.com>\nDate:   Fri May 18 20:59:18 2018 +0800\n\n    wrote a readme file\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br")])]),a("p",[a("code",[e._v("git log")]),e._v("命令显示从最近到最远的提交日志，我们可以看到3次提交，最近的一次是"),a("code",[e._v("append GPL")]),e._v("，上一次是"),a("code",[e._v("add distributed")]),e._v("，最早的一次是"),a("code",[e._v("wrote a readme file")]),e._v("。")]),e._v(" "),a("p",[e._v("如果嫌输出信息太多，看得眼花缭乱的，可以试试加上"),a("code",[e._v("--pretty=oneline")]),e._v("参数：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ git log --pretty=oneline\n1094adb7b9b3807259d8cb349e7df1d4d6477073 (HEAD -> master) append GPL\ne475afc93c209a690c39c13a46716e8fa000c366 add distributed\neaadf4e385e865d25c48e7ca9c8395c3f7dfaef0 wrote a readme file\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("p",[e._v("需要友情提示的是，你看到的一大串类似"),a("code",[e._v("1094adb...")]),e._v("的是"),a("code",[e._v("commit id")]),e._v("（版本号），和SVN不一样，Git的"),a("code",[e._v("commit id")]),e._v("不是1，2，3……递增的数字，而是一个SHA1计算出来的一个非常大的数字，用十六进制表示，而且你看到的"),a("code",[e._v("commit id")]),e._v("和我的肯定不一样，以你自己的为准。为什么"),a("code",[e._v("commit id")]),e._v("需要用这么一大串数字表示呢？因为Git是分布式的版本控制系统，后面我们还要研究多人在同一个版本库里工作，如果大家都用1，2，3……作为版本号，那肯定就冲突了。")]),e._v(" "),a("p",[e._v("每提交一个新版本，实际上Git就会把它们自动串成一条时间线。如果使用可视化工具查看Git历史，就可以更清楚地看到提交历史的时间线：")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://www.liaoxuefeng.com/files/attachments/919019707114272/0",alt:"git-log-timeline"}})]),e._v(" "),a("p",[e._v("好了，现在我们启动时光穿梭机，准备把"),a("code",[e._v("readme.txt")]),e._v("回退到上一个版本，也就是"),a("code",[e._v("add distributed")]),e._v("的那个版本，怎么做呢？")]),e._v(" "),a("p",[e._v("首先，Git必须知道当前版本是哪个版本，在Git中，用"),a("code",[e._v("HEAD")]),e._v("表示当前版本，也就是最新的提交"),a("code",[e._v("1094adb...")]),e._v("（注意我的提交ID和你的肯定不一样），上一个版本就是"),a("code",[e._v("HEAD^")]),e._v("，上上一个版本就是"),a("code",[e._v("HEAD^^")]),e._v("，当然往上100个版本写100个"),a("code",[e._v("^")]),e._v("比较容易数不过来，所以写成"),a("code",[e._v("HEAD~100")]),e._v("。")]),e._v(" "),a("p",[e._v("现在，我们要把当前版本"),a("code",[e._v("append GPL")]),e._v("回退到上一个版本"),a("code",[e._v("add distributed")]),e._v("，就可以使用"),a("code",[e._v("git reset")]),e._v("命令：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ git reset --hard HEAD^\nHEAD is now at e475afc add distributed\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[a("code",[e._v("--hard")]),e._v("参数有啥意义？这个后面再讲，现在你先放心使用。")]),e._v(" "),a("p",[e._v("看看"),a("code",[e._v("readme.txt")]),e._v("的内容是不是版本"),a("code",[e._v("add distributed")]),e._v("：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ cat readme.txt\nGit is a distributed version control system.\nGit is free software.\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("果然被还原了。")]),e._v(" "),a("p",[e._v("还可以继续回退到上一个版本"),a("code",[e._v("wrote a readme file")]),e._v("，不过且慢，然我们用"),a("code",[e._v("git log")]),e._v("再看看现在版本库的状态：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ git log\ncommit e475afc93c209a690c39c13a46716e8fa000c366 (HEAD -> master)\nAuthor: Michael Liao <askxuefeng@gmail.com>\nDate:   Fri May 18 21:03:36 2018 +0800\n\n    add distributed\n\ncommit eaadf4e385e865d25c48e7ca9c8395c3f7dfaef0\nAuthor: Michael Liao <askxuefeng@gmail.com>\nDate:   Fri May 18 20:59:18 2018 +0800\n\n    wrote a readme file\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br")])]),a("p",[e._v("最新的那个版本"),a("code",[e._v("append GPL")]),e._v("已经看不到了！好比你从21世纪坐时光穿梭机来到了19世纪，想再回去已经回不去了，肿么办？")]),e._v(" "),a("p",[e._v("办法其实还是有的，只要上面的命令行窗口还没有被关掉，你就可以顺着往上找啊找啊，找到那个"),a("code",[e._v("append GPL")]),e._v("的"),a("code",[e._v("commit id")]),e._v("是"),a("code",[e._v("1094adb...")]),e._v("，于是就可以指定回到未来的某个版本：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ git reset --hard 1094a\nHEAD is now at 83b0afe append GPL\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("版本号没必要写全，前几位就可以了，Git会自动去找。当然也不能只写前一两位，因为Git可能会找到多个版本号，就无法确定是哪一个了。")]),e._v(" "),a("p",[e._v("再小心翼翼地看看"),a("code",[e._v("readme.txt")]),e._v("的内容：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ cat readme.txt\nGit is a distributed version control system.\nGit is free software distributed under the GPL.\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("果然，我胡汉三又回来了。")]),e._v(" "),a("p",[e._v("Git的版本回退速度非常快，因为Git在内部有个指向当前版本的"),a("code",[e._v("HEAD")]),e._v("指针，当你回退版本的时候，Git仅仅是把HEAD从指向"),a("code",[e._v("append GPL")]),e._v("：")]),e._v(" "),a("div",{staticClass:"language-ascii line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("┌────┐\n│HEAD│\n└────┘\n   │\n   └──> ○ append GPL\n        │\n        ○ add distributed\n        │\n        ○ wrote a readme file\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br")])]),a("p",[e._v("改为指向"),a("code",[e._v("add distributed")]),e._v("：")]),e._v(" "),a("div",{staticClass:"language-ascii line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("┌────┐\n│HEAD│\n└────┘\n   │\n   │    ○ append GPL\n   │    │\n   └──> ○ add distributed\n        │\n        ○ wrote a readme file\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br")])]),a("p",[e._v("然后顺便把工作区的文件更新了。所以你让"),a("code",[e._v("HEAD")]),e._v("指向哪个版本号，你就把当前版本定位在哪。")]),e._v(" "),a("p",[e._v("现在，你回退到了某个版本，关掉了电脑，第二天早上就后悔了，想恢复到新版本怎么办？找不到新版本的"),a("code",[e._v("commit id")]),e._v("怎么办？")]),e._v(" "),a("p",[e._v("在Git中，总是有后悔药可以吃的。当你用"),a("code",[e._v("$ git reset --hard HEAD^")]),e._v("回退到"),a("code",[e._v("add distributed")]),e._v("版本时，再想恢复到"),a("code",[e._v("append GPL")]),e._v("，就必须找到"),a("code",[e._v("append GPL")]),e._v("的commit id。Git提供了一个命令"),a("code",[e._v("git reflog")]),e._v("用来记录你的每一次命令：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ git reflog\ne475afc HEAD@{1}: reset: moving to HEAD^\n1094adb (HEAD -> master) HEAD@{2}: commit: append GPL\ne475afc HEAD@{3}: commit: add distributed\neaadf4e HEAD@{4}: commit (initial): wrote a readme file\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("p",[e._v("终于舒了口气，从输出可知，"),a("code",[e._v("append GPL")]),e._v("的commit id是"),a("code",[e._v("1094adb")]),e._v("，现在，你又可以乘坐时光机回到未来了。")]),e._v(" "),a("h3",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[e._v("#")]),e._v(" 小结")]),e._v(" "),a("p",[e._v("现在总结一下：")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("HEAD")]),e._v("指向的版本就是当前版本，因此，Git允许我们在版本的历史之间穿梭，使用命令"),a("code",[e._v("git reset --hard commit_id")]),e._v("。")]),e._v(" "),a("li",[e._v("穿梭前，用"),a("code",[e._v("git log")]),e._v("可以查看提交历史，以便确定要回退到哪个版本。")]),e._v(" "),a("li",[e._v("要重返未来，用"),a("code",[e._v("git reflog")]),e._v("查看命令历史，以便确定要回到未来的哪个版本。")])])])}),[],!1,null,null,null);s.default=n.exports}}]);